# Install WebSphere Application Server - Network Deployment
#
# Variables used in this playbook that can be setup at hosts file.
#
# HTTP server that has installation Files
#   was_repository_url:    http://192.168.1.1/was/9.0.5
#
# How to Run
#

# ansible-playbook -i environments/hosts.development -u <username> -k playbooks/ibm-was-nd-complete.yml
#
#
#vars:
  #tmp_dir:              "/opt/IBM/Binaries/was"
  #iim_install_location: "/opt/IBM/InstallationManager"
  #was_install_location: "/opt/IBM/WebSphere/AppServer"
  #imshared_location:    "/opt/IBM/IMShared"

  #was_version:          "9.0.5001.20190828_0616"
  #was_files:
  #  - { file_name: was.repo.90501.nd.zip, check_sum: afd5c4f868ba0fd52f348aa292f67595b0552a0e54b31d4d8054ffb546841cf4 }

  #was_fp_version:       "9.0.5018.20231113_1345"
  #was_fp_files:
  #  - { file_name: 9.0.5-WS-WAS-FP018.zip, check_sum: 83a6c682edc52e138d2bb1a5c87b2478c5b3d1a9141295a39daa5bce505889e3 }

  #was_java_version:     "8.0.2010.20160224_1829"
  #was_java_files:
  #  - { file_name: ibm-java-sdk-8.0-8.20-linux-x64-installmgr.zip, check_sum: 351f266255ccbbf13293f7e35fe5fea01f2f9f4dd78e92310d97dc55fe15c4a4 }
---
- name:                    Install WebSphere Application Server - Network Deployment
  hosts:                   dmgr,was_servers
  #  serial:                  2
  become:                  true
  roles:
    - roles/installation-manager-install
    - roles/was-nd-install
    - roles/was-nd-fix-install

- name:                    Install HTTP Servers
  hosts:                   ihs_servers
  become:                  true
  roles:
    - roles/installation-manager-install
    - roles/ibm-http-server-install
    - roles/ibm-http-server-fix-install
    - roles/ibm-http-config-plgwct
    - roles/ibm-http-adminctl-restart
    - roles/ibm-http-server-restart

- name:                    Setup DMGR
  hosts:                   dmgr
  become:                  true
  roles:
    - roles/was-dmgr-create-profile
    - roles/was-dmgr-start
    # - roles/was-dmgr-import-tls-cert
    # - roles/was-dmgr-config-ldap
    - roles/was-dmgr-config-jvm
    - roles/was-dmgr-restart

- name:                    Setup WAS Nodes
  hosts:                   was_servers
  serial:                  1
  become:                  true
  roles:
    - roles/was-profile-create
    - roles/was-nodeagent-start

- name:                    Setup HTTP Servers on DMGR
  hosts:                   dmgr
  become:                  true
  roles:
    - roles/was-dmgr-config-webserver